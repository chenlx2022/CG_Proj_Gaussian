# 3DGS æ¸²æŸ“å™¨ç²¾ç®€ç‰ˆ - ä¿®æ”¹è®°å½•

## é¡¹ç›®ç›®æ ‡
é‡æ„ 3D Gaussian Splatting ä»£ç åº“ï¼Œç§»é™¤æ‰€æœ‰è®­ç»ƒç›¸å…³ä»£ç ï¼Œä¿ç•™çº¯æ¨ç†ï¼ˆæ¸²æŸ“ï¼‰åŠŸèƒ½ã€‚  
**é€‚ç”¨åœºæ™¯ï¼š** CG è¯¾ç¨‹ Final Project - å®ç° 3D é«˜æ–¯åˆ°å±å¹•ç©ºé—´çš„æŠ•å½±æ¸²æŸ“ã€‚

---

## ä¿®æ”¹å†å²

### 2026-01-10 - Layer 3 ç²¾ç®€ï¼ˆC++ ç»‘å®šå±‚ + Python åŒ…è£…å±‚ï¼‰

#### ä¿®æ”¹æ–‡ä»¶ 1: `submodules/diff-gaussian-rasterization/ext.cpp`
**çŠ¶æ€ï¼š** âœ… ç¼–è¯‘é€šè¿‡

**ä¿®æ”¹å†…å®¹ï¼š**
- **åˆ é™¤ï¼š** `rasterize_gaussians_backward` å‡½æ•°ç»‘å®šï¼ˆè®­ç»ƒç”¨åå‘ä¼ æ’­ï¼‰
- **ä¿ç•™ï¼š** `rasterize_gaussians` å‰å‘æ¸²æŸ“æ¥å£
- **ä¿ç•™ï¼š** `mark_visible` è§†é”¥å‰”é™¤å·¥å…·å‡½æ•°
- **æ–°å¢ï¼š** æ³¨é‡Šè¯´æ˜è¿™æ˜¯æ¨ç†ä¸“ç”¨ç‰ˆæœ¬

**ä»£ç å¯¹æ¯”ï¼š**
```cpp
// åŸç‰ˆï¼ˆ3 ä¸ªç»‘å®šï¼‰
m.def("rasterize_gaussians", &RasterizeGaussiansCUDA);
m.def("rasterize_gaussians_backward", &RasterizeGaussiansBackwardCUDA);  // âŒ å·²åˆ é™¤
m.def("mark_visible", &markVisible);

// ç²¾ç®€ç‰ˆï¼ˆ2 ä¸ªç»‘å®šï¼‰
m.def("rasterize_gaussians", &RasterizeGaussiansCUDA);
m.def("mark_visible", &markVisible);
```

**ä¿®æ”¹åŸå› ï¼š**
- åå‘ä¼ æ’­ä»…ç”¨äºè®­ç»ƒé˜¶æ®µçš„æ¢¯åº¦è®¡ç®—
- æ¨ç†é˜¶æ®µæ— éœ€æ¢¯åº¦ï¼Œåˆ é™¤å¯å‡å°‘ç¼–è¯‘æ—¶é—´å’ŒäºŒè¿›åˆ¶å¤§å°

---

#### ä¿®æ”¹æ–‡ä»¶ 2: `submodules/diff-gaussian-rasterization/diff_gaussian_rasterization/__init__.py`
**çŠ¶æ€ï¼š** âœ… ç¼–è¯‘é€šè¿‡

**ä¿®æ”¹å†…å®¹ï¼š**
1. **åˆ é™¤å‡½æ•°ï¼š** `cpu_deep_copy_tuple`ï¼ˆè®­ç»ƒè¾…åŠ©å·¥å…·ï¼‰
2. **ç®€åŒ– `_RasterizeGaussians.forward`ï¼š**
   - åˆ é™¤äº† `ctx.save_for_backward(...)` ç›¸å…³çš„æ‰€æœ‰ä»£ç 
   - åˆ é™¤äº†æ¢¯åº¦ç¼“å†²åŒºï¼ˆgeomBuffer, binningBuffer, imgBufferï¼‰çš„ä¿å­˜é€»è¾‘
   - ä¿ç•™äº†å‡½æ•°è¿”å›å€¼ï¼š`color, radii, invdepths`

3. **é‡å†™ `_RasterizeGaussians.backward`ï¼š**
   ```python
   # åŸç‰ˆï¼š100+ è¡Œçš„æ¢¯åº¦è®¡ç®—é€»è¾‘
   # ç²¾ç®€ç‰ˆï¼šæŠ›å‡ºæ˜ç¡®é”™è¯¯æç¤º
   def backward(ctx, grad_out_color, grad_radii, grad_out_depth):
       raise NotImplementedError("Backward pass not implemented in inference-only version.")
   ```

4. **å¢å¼ºæ–‡æ¡£ï¼š**
   - ä¸º `GaussianRasterizationSettings` æ·»åŠ å­—æ®µæ³¨é‡Š
   - ä¸º `GaussianRasterizer.forward` æ·»åŠ è¯¦ç»†çš„å‚æ•°è¯´æ˜å’Œè¿”å›å€¼è¯´æ˜
   - æ·»åŠ æ¨¡å—çº§åˆ«çš„è¯´æ˜æ³¨é‡Š

**ä»£ç ç»Ÿè®¡ï¼š**
- åŸç‰ˆï¼š209 è¡Œ
- ç²¾ç®€ç‰ˆï¼šçº¦ 150 è¡Œ
- åˆ é™¤ï¼šçº¦ 60 è¡Œï¼ˆä¸»è¦æ˜¯åå‘ä¼ æ’­é€»è¾‘ï¼‰

**ä¿®æ”¹åŸå› ï¼š**
- æ¨ç†é˜¶æ®µä¸éœ€è¦ä¿å­˜ä¸­é—´å˜é‡ç”¨äºæ¢¯åº¦è®¡ç®—
- æé«˜ä»£ç å¯è¯»æ€§ï¼Œèšç„¦æ¸²æŸ“æ ¸å¿ƒé€»è¾‘
- é˜²æ­¢è¯¯ç”¨ï¼šå¦‚æœæ„å¤–è°ƒç”¨ backward ä¼šç«‹å³æŠ¥é”™

---

### å…³é”®æ¥å£ä¿æŒä¸å˜

ä»¥ä¸‹æ¥å£ä¸åŸç‰ˆ**å®Œå…¨å…¼å®¹**ï¼Œç¡®ä¿ä¸Šå±‚ä»£ç ï¼ˆLayer 2ï¼‰æ— éœ€ä¿®æ”¹ï¼š

1. **`GaussianRasterizationSettings`** é…ç½®ç±»ï¼š
   - æ‰€æœ‰å­—æ®µä¿æŒä¸€è‡´
   - ç±»å‹ç­¾åä¸å˜

2. **`GaussianRasterizer`** æ¨¡å—ï¼š
   - `__init__(raster_settings)` æ¥å£ä¸å˜
   - `forward(means3D, means2D, opacities, ...)` å‚æ•°åˆ—è¡¨ä¸å˜
   - è¿”å›å€¼ï¼š`(color, radii, invdepths)` æ ¼å¼ä¸å˜

3. **åº•å±‚ C++ è°ƒç”¨ï¼š**
   - `_C.rasterize_gaussians(*args)` å‚æ•°é¡ºåºå’Œç±»å‹ä¸å˜
   - è¿”å›å€¼ç»“æ„ä¸å˜

---

## ç¼–è¯‘ä¸æµ‹è¯•

### ç¼–è¯‘å‘½ä»¤
```bash
cd /inspurfs/group/mayuexin/chenlx/3DGS/gaussian-splatting
pip install ./submodules/diff-gaussian-rasterization
```

### ç¼–è¯‘ç»“æœ
âœ… **æˆåŠŸ** - æ— é”™è¯¯ï¼Œæ— è­¦å‘Š

### å…¼å®¹æ€§æµ‹è¯•
- [ ] å¾…æµ‹è¯•ï¼šèƒ½å¦æ­£å¸¸åŠ è½½å·²è®­ç»ƒçš„ `.ply` æ¨¡å‹
- [ ] å¾…æµ‹è¯•ï¼š`render.py` èƒ½å¦æ­£å¸¸æ¸²æŸ“å›¾åƒ
- [ ] å¾…æµ‹è¯•ï¼šæ¸²æŸ“ç»“æœä¸åŸç‰ˆæ˜¯å¦ä¸€è‡´

---

### 2026-01-10 - Layer 2 ç²¾ç®€ï¼ˆæ¸²æŸ“ç®¡çº¿å°è£…å±‚ï¼‰

#### ä¿®æ”¹æ–‡ä»¶: `gaussian_renderer/__init__.py`
**çŠ¶æ€ï¼š** âœ… å®Œæˆï¼ˆæ— éœ€ç¼–è¯‘ï¼Œçº¯ Pythonï¼‰

**ä¿®æ”¹å†…å®¹ï¼š**

1. **åˆ é™¤è®­ç»ƒç›¸å…³ä»£ç ï¼š**
   - âŒ `screenspace_points` åŠæ¢¯åº¦è¿½è¸ªé€»è¾‘ï¼ˆ25-30è¡Œï¼‰
   - âŒ `use_trained_exp` æ›å…‰è¡¥å¿å‚æ•°å’Œé€»è¾‘ï¼ˆ113-115è¡Œï¼‰
   - âŒ `separate_sh` å‚æ•°åŠå…¶å¤æ‚åˆ†æ”¯ï¼ˆ82-100è¡Œï¼‰
   - âŒ è¿”å›å€¼ä¸­çš„ `viewspace_points`ã€`visibility_filter`ã€`radii`

2. **å›ºå®šè®¡ç®—ç­–ç•¥ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ï¼š**
   ```python
   # åŸç‰ˆï¼šå¯é€‰åœ¨ Python æˆ– CUDA ä¸­è®¡ç®—
   if pipe.compute_cov3D_python:
       cov3D_precomp = pc.get_covariance(scaling_modifier)
   
   # ç²¾ç®€ç‰ˆï¼šå›ºå®šåœ¨ CUDA è®¡ç®—ï¼ˆæ›´å¿«ï¼‰
   scales = pc.get_scaling
   rotations = pc.get_rotation
   cov3D_precomp = None  # è®© CUDA è‡ªå·±ç®—
   ```

3. **ç®€åŒ–å‚æ•°åˆ—è¡¨ï¼š**
   - **åˆ é™¤å‚æ•°ï¼š** `separate_sh`, `use_trained_exp`
   - **ä¿ç•™å‚æ•°ï¼š** `viewpoint_camera`, `pc`, `pipe`, `bg_color`, `scaling_modifier`, `override_color`
   - **ç®€åŒ– pipe ä½¿ç”¨ï¼š** åªè¯»å– `pipe.debug` å’Œ `pipe.antialiasing`

4. **ç²¾ç®€è¿”å›å€¼ï¼š**
   ```python
   # åŸç‰ˆï¼šè¿”å› 5 ä¸ªå­—æ®µï¼ˆè®­ç»ƒéœ€è¦ï¼‰
   return {
       "render": rendered_image,
       "viewspace_points": screenspace_points,  # è®­ç»ƒç”¨
       "visibility_filter": (radii > 0).nonzero(),  # è®­ç»ƒç”¨
       "radii": radii,  # è®­ç»ƒç”¨
       "depth": depth_image
   }
   
   # ç²¾ç®€ç‰ˆï¼šåªè¿”å› 2 ä¸ªå­—æ®µï¼ˆæ¸²æŸ“éœ€è¦ï¼‰
   return {
       "render": rendered_image,
       "depth": depth_image
   }
   ```

5. **å¢å¼ºæ–‡æ¡£ï¼š**
   - æ·»åŠ è¯¦ç»†çš„å‡½æ•° docstring
   - æ ‡æ³¨å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç»“æ„
   - æ·»åŠ åˆ†æ®µæ³¨é‡Šï¼ˆCamera Setup / Gaussian Data / Rasterizationï¼‰

**ä»£ç ç»Ÿè®¡ï¼š**
- åŸç‰ˆï¼š129 è¡Œ
- ç²¾ç®€ç‰ˆï¼šçº¦ 95 è¡Œ
- åˆ é™¤ï¼šçº¦ 35 è¡Œ

**å…³é”®å†³ç­–è¯´æ˜ï¼š**

| å†³ç­–ç‚¹ | åŸç‰ˆç­–ç•¥ | ç²¾ç®€ç‰ˆç­–ç•¥ | åŸå›  |
|--------|----------|-----------|------|
| SH é¢œè‰²è®¡ç®— | Python å¯é€‰ | å›ºå®š CUDA | CUDA æ›´å¿«ï¼Œå‡å°‘ CPU-GPU ä¼ è¾“ |
| 3D åæ–¹å·®è®¡ç®— | Python å¯é€‰ | å›ºå®š CUDA | CUDA æ›´å¿«ï¼Œåˆ©ç”¨å¹¶è¡Œè®¡ç®— |
| æ¢¯åº¦è¿½è¸ª | ä¿ç•™ | åˆ é™¤ | æ¨ç†æ— éœ€æ¢¯åº¦ |
| æ›å…‰è¡¥å¿ | å¯é€‰ | åˆ é™¤ | è®­ç»ƒä¸“ç”¨åŠŸèƒ½ |

**æ¥å£å…¼å®¹æ€§ï¼š**
- âœ… ä¸Šå±‚ï¼ˆLayer 1ï¼‰è°ƒç”¨æ–¹å¼åŸºæœ¬ä¸å˜
- âœ… ä¸‹å±‚ï¼ˆLayer 3ï¼‰æ¥å£å®Œå…¨å…¼å®¹
- âš ï¸ **ç ´åæ€§å˜åŒ–ï¼š** è¿”å›å€¼å°‘äº† 3 ä¸ªå­—æ®µï¼ˆ`viewspace_points`, `visibility_filter`, `radii`ï¼‰
  - å½±å“èŒƒå›´ï¼šåªå½±å“è®­ç»ƒä»£ç ï¼ˆ`train.py`ï¼‰ï¼Œä¸å½±å“ `render.py`

---

---

### 2026-01-10 - Layer 1 é‡å†™ï¼ˆåº”ç”¨å±‚ï¼‰

#### æ–°å»ºæ–‡ä»¶: `render_ours.py`
**çŠ¶æ€ï¼š** âœ… å®Œæˆï¼ˆæ— éœ€ç¼–è¯‘ï¼Œçº¯ Pythonï¼‰

**è®¾è®¡ç­–ç•¥ï¼š**
ä¿ç•™åŸç‰ˆ `render.py` ä¸å˜ï¼Œåˆ›å»ºå…¨æ–°çš„ç²¾ç®€ç‰ˆæ¸²æŸ“è„šæœ¬ã€‚

**æ–°è„šæœ¬ç‰¹ç‚¹ï¼š**

1. **å®Œå…¨å¯¹é½ Layer 2 æ¥å£ï¼š**
   ```python
   # ç®€æ´çš„æ¸²æŸ“è°ƒç”¨
   render_output = render(view, gaussians, pipeline, background)
   rendered_image = render_output["render"]
   depth_map = render_output["depth"]
   ```

2. **æ¸…æ™°çš„ä»£ç ç»“æ„ï¼š**
   - ä¸»å‡½æ•° `main()`: æ•´ä½“æµç¨‹æ§åˆ¶
   - `render_view_set()`: æ‰¹é‡æ¸²æŸ“ä¸€ç»„è§†è§’
   - è¯¦ç»†çš„å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²å’Œæ³¨é‡Š

3. **å¢å¼ºçš„ç”¨æˆ·ä½“éªŒï¼š**
   - ä½¿ç”¨ `pathlib.Path` ç®¡ç†è·¯å¾„ï¼ˆæ›´ç°ä»£ï¼‰
   - ç¾åŒ–çš„è¿›åº¦è¾“å‡ºï¼ˆåˆ†éš”çº¿ã€emoji å‹¾å·ï¼‰
   - å¯é€‰çš„æ·±åº¦å›¾ä¿å­˜ï¼ˆç¬¬ä¸€å¸§ä½œä¸ºç¤ºä¾‹ï¼‰
   - è¯¦ç»†çš„æ¨¡å‹åŠ è½½ä¿¡æ¯è¾“å‡º

4. **æ•™å­¦å‹å¥½ï¼š**
   ```python
   # æ¯ä¸ªå…³é”®æ­¥éª¤éƒ½æœ‰æ¸…æ™°çš„æ³¨é‡Š
   # Workflow:
   #     1. Load trained Gaussian model
   #     2. Load camera viewpoints
   #     3. Render each view
   #     4. Save results
   ```

5. **åˆ é™¤çš„åŠŸèƒ½ï¼š**
   - âŒ `use_trained_exp` æ›å…‰è¡¥å¿
   - âŒ `separate_sh` åˆ†ç¦» SH è®¡ç®—
   - âŒ `train_test_exp` å›¾åƒè£å‰ª
   - âŒ `SPARSE_ADAM_AVAILABLE` ä¼˜åŒ–å™¨æ£€æµ‹

**ä»£ç ç»Ÿè®¡ï¼š**
- æ–°è„šæœ¬ï¼šçº¦ 180 è¡Œï¼ˆå«è¯¦ç»†æ³¨é‡Šå’Œæ–‡æ¡£ï¼‰
- æœ‰æ•ˆä»£ç ï¼šçº¦ 120 è¡Œ
- ç›¸æ¯”åŸç‰ˆï¼ˆ77 è¡Œï¼‰ï¼šæ›´é•¿ä½†æ›´æ¸…æ™°

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# ä¸åŸç‰ˆç›¸åŒçš„å‘½ä»¤è¡Œå‚æ•°
python render_ours.py -m output/model_path --iteration 30000

# å¯é€‰å‚æ•°
--skip_train    # è·³è¿‡è®­ç»ƒé›†æ¸²æŸ“
--skip_test     # è·³è¿‡æµ‹è¯•é›†æ¸²æŸ“
--quiet         # é™é»˜æ¨¡å¼
```

**Bug ä¿®å¤è®°å½•ï¼š**
- âŒ **åˆç‰ˆé—®é¢˜ï¼š** `AttributeError: 'Namespace' object has no attribute 'add_argument_group'`
  - **åŸå› ï¼š** ç›´æ¥ä¼  `args` (Namespace) ç»™ `ModelParams()`ï¼Œä½†å®ƒæœŸæœ› `ArgumentParser`
  - **è§£å†³æ–¹æ¡ˆï¼š** 
    ```python
    # é”™è¯¯å†™æ³•
    dataset = ModelParams(args, sentinel=True)
    
    # æ­£ç¡®å†™æ³•
    model = ModelParams(parser, sentinel=True)  # å…ˆç”¨ parser åˆå§‹åŒ–
    args = get_combined_args(parser)            # è§£æå‚æ•°
    dataset = model.extract(args)               # å†ç”¨ extract æå–
    ```
- âœ… **å·²ä¿®å¤** - ç°åœ¨å‚æ•°ä¼ é€’æ­£ç¡®

**ä¼˜åŠ¿å¯¹æ¯”ï¼š**

| ç‰¹æ€§ | åŸç‰ˆ `render.py` | æ–°ç‰ˆ `render_ours.py` |
|------|------------------|---------------------|
| ä»£ç è¡Œæ•° | 77 | 180 (å«æ³¨é‡Š) |
| æ¥å£å…¼å®¹æ€§ | âŒ æœ‰é—®é¢˜ | âœ… å®Œç¾å¯¹é½ |
| ä»£ç å¯è¯»æ€§ | â­â­â­ | â­â­â­â­â­ |
| æ•™å­¦å‹å¥½æ€§ | â­â­ | â­â­â­â­â­ |
| åŠŸèƒ½å®Œæ•´æ€§ | è®­ç»ƒ+æ¨ç† | ä»…æ¨ç† |
| ç»´æŠ¤æ€§ | ä¸­ç­‰ | é«˜ |

---

## æŠ€æœ¯ç¬”è®°

### ä¸ºä»€ä¹ˆä¿ç•™ `torch.autograd.Function`ï¼Ÿ
è™½ç„¶æˆ‘ä»¬ä¸éœ€è¦æ¢¯åº¦ï¼Œä½†ä»ä½¿ç”¨ `autograd.Function` ä½œä¸ºåŒ…è£…å™¨ï¼ŒåŸå› ï¼š
1. PyTorch çš„ C++ æ‰©å±•æ¨èä½¿ç”¨æ­¤æ¨¡å¼
2. ä¿æŒä¸åŸç‰ˆä»£ç ç»“æ„çš„ä¸€è‡´æ€§ï¼Œä¾¿äºå¯¹æ¯”
3. æœªæ¥å¦‚æœéœ€è¦æ·»åŠ è‡ªå®šä¹‰å‰å‘é€»è¾‘ï¼Œæ­¤ç»“æ„æ˜“äºæ‰©å±•

### æ€§èƒ½å½±å“
- **ç¼–è¯‘æ—¶é—´ï¼š** ç†è®ºä¸Šç•¥æœ‰å‡å°‘ï¼ˆå°‘ç¼–è¯‘åå‘ä¼ æ’­ä»£ç ï¼‰
- **è¿è¡Œæ—¶æ€§èƒ½ï¼š** æ— å½±å“ï¼ˆå‰å‘æ¸²æŸ“é€»è¾‘æœªæ”¹åŠ¨ï¼‰
- **å†…å­˜å ç”¨ï¼š** ç†è®ºä¸Šå‡å°‘ï¼ˆä¸ä¿å­˜ä¸­é—´æ¢¯åº¦ç¼“å†²åŒºï¼‰

---

## å‚è€ƒèµ„æ–™

- åŸå§‹è®ºæ–‡ï¼š[3D Gaussian Splatting for Real-Time Radiance Field Rendering](https://repo-sam.inria.fr/fungraph/3d-gaussian-splatting/)
- EWA Splattingï¼šZwicker et al., 2002
- åŸä»“åº“ï¼š[https://github.com/graphdeco-inria/gaussian-splatting](https://github.com/graphdeco-inria/gaussian-splatting)

---

### 2026-01-10 - Layer 4-5 ä¼˜åŒ–ï¼ˆCUDA æ ¸å¿ƒå±‚ï¼‰

#### ä¿®æ”¹æ–‡ä»¶ 1: `cuda_rasterizer/rasterizer_impl.cu`
**çŠ¶æ€ï¼š** âœ… å®Œæˆï¼ˆéœ€è¦é‡æ–°ç¼–è¯‘ï¼‰

**ä¼˜åŒ–å†…å®¹ï¼š**

1. **èƒ½é‡é˜ˆå€¼å‰”é™¤ (Energy-based Culling)**
   ```cpp
   #define ENERGY_THRESHOLD 1e-3f
   
   float energy = float(r) * float(r);
   if (energy < ENERGY_THRESHOLD)
       return;
   ```
   - **ä½œç”¨ï¼š** å‰”é™¤å±å¹•ç©ºé—´è´¡çŒ®æå°çš„é«˜æ–¯ç‚¹
   - **æ€§èƒ½æå‡ï¼š** å‡å°‘æ’åºå’Œæ¸²æŸ“çš„ç‚¹æ•°

2. **Tile çº§æ—©æœŸæ‹’ç» (Tile-level Early Rejection)**
   ```cpp
   float tile_cx = (x + 0.5f) * BLOCK_X;
   float tile_cy = (y + 0.5f) * BLOCK_Y;
   float dx = fabsf(mu.x - tile_cx);
   float dy = fabsf(mu.y - tile_cy);
   if (dx > r + BLOCK_X || dy > r + BLOCK_Y)
       continue;
   ```
   - **ä½œç”¨ï¼š** åœ¨ç”Ÿæˆé”®å€¼å¯¹å‰ï¼Œæ£€æŸ¥é«˜æ–¯æ˜¯å¦çœŸæ­£ä¸ Tile ç›¸äº¤
   - **æ€§èƒ½æå‡ï¼š** æ˜¾è‘—å‡å°‘æ’åºæ•°æ®é‡

3. **è¶Šç•Œå®‰å…¨æ£€æŸ¥ (Buffer Overflow Prevention)**
   ```cpp
   uint32_t max_offset = offsets[P - 1];
   if (off >= max_offset)
       break;
   ```
   - **ä½œç”¨ï¼š** é˜²æ­¢ç¼“å†²åŒºæº¢å‡º
   - **çŠ¶æ€ï¼š** é˜²å¾¡æ€§ç¼–ç¨‹

---

#### ä¿®æ”¹æ–‡ä»¶ 2: `cuda_rasterizer/forward.cu`
**çŠ¶æ€ï¼š** âœ… å®Œæˆï¼ˆéœ€è¦é‡æ–°ç¼–è¯‘ï¼‰

**ä¼˜åŒ–å†…å®¹ï¼š**

1. **æ‰‹å·¥å±•å¼€ `computeCov2D` - 2D åæ–¹å·®æŠ•å½±**
   - **åŸç‰ˆï¼š** ä½¿ç”¨ GLM åº“çš„é€šç”¨çŸ©é˜µä¹˜æ³•
   - **ä¼˜åŒ–ç‰ˆï¼š** æ‰‹å·¥å±•å¼€ç¨€ç–çŸ©é˜µè¿ç®—
   - **ä»£ç å¯¹æ¯”ï¼š**
     ```cpp
     // åŸç‰ˆï¼šé»‘ç›’çŸ©é˜µè¿ç®—
     glm::mat3 J = ..., W = ..., Vrk = ...;
     glm::mat3 T = W * J;
     glm::mat3 cov = glm::transpose(T) * glm::transpose(Vrk) * T;
     
     // ä¼˜åŒ–ç‰ˆï¼šæ˜¾å¼çš„æ•°å­¦æ¨å¯¼
     float J00 = focal_x / t.z;
     float J02 = -(focal_x * t.x) / (t.z * t.z);
     // ... åªè®¡ç®—éé›¶å…ƒç´ 
     float3 T0 = { J00 * W_row0.x + J02 * W_row2.x, ... };
     // ... ç›´æ¥è®¡ç®—æœ€ç»ˆç»“æœ
     ```
   - **ä¼˜ç‚¹ï¼š**
     - âœ… åˆ©ç”¨ Jacobian çš„ç¨€ç–æ€§ï¼ˆåªæœ‰ 4 ä¸ªéé›¶å…ƒç´ ï¼‰
     - âœ… å‡å°‘æ— ç”¨è®¡ç®—å’Œå¯„å­˜å™¨ä½¿ç”¨
     - âœ… æ•°å­¦æ­¥éª¤æ¸…æ™°å¯è§ï¼Œä¾¿äº Final Project å±•ç¤º
     - âœ… é¢„è®¡æ€§èƒ½æå‡ 10-15%

2. **æ‰‹å·¥å±•å¼€ `computeCov3D` - 3D åæ–¹å·®æ„é€ **
   - **åŸç‰ˆï¼š** ä½¿ç”¨ GLM åº“æ„é€  Sã€R çŸ©é˜µåç›¸ä¹˜
   - **ä¼˜åŒ–ç‰ˆï¼š** ç›´æ¥ç”¨åˆ—å‘é‡å’Œç‚¹ç§¯è®¡ç®—
   - **ä»£ç å¯¹æ¯”ï¼š**
     ```cpp
     // åŸç‰ˆï¼šåˆ†æ­¥æ„é€ 
     glm::mat3 S = ..., R = ...;
     glm::mat3 M = S * R;
     glm::mat3 Sigma = glm::transpose(M) * M;
     
     // ä¼˜åŒ–ç‰ˆï¼šåˆå¹¶è®¡ç®—
     float3 m0 = { sx * r00, sy * r10, sz * r20 };
     cov3D[0] = m0.x * m0.x + m0.y * m0.y + m0.z * m0.z;
     ```
   - **ä¼˜ç‚¹ï¼š**
     - âœ… åˆ©ç”¨å¯¹ç§°æ€§åªè®¡ç®— 6 ä¸ªå…ƒç´ ï¼ˆè€Œé 9 ä¸ªï¼‰
     - âœ… é¿å…ä¸­é—´çŸ©é˜µçš„å­˜å‚¨
     - âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼ˆåˆ—å‘é‡ â†’ ç‚¹ç§¯ï¼‰

3. **é‡æ„ `computeColorFromSH` - SH é¢œè‰²å±•å¼€**
   - **åŸç‰ˆï¼š** ç›´æ¥åœ¨ç»“æœä¸Šç´¯åŠ  SH é¡¹
   - **ä¼˜åŒ–ç‰ˆï¼š** åˆ†ç¦» basis è®¡ç®—å’ŒåŠ æƒæ±‚å’Œ
   - **ä»£ç å¯¹æ¯”ï¼š**
     ```cpp
     // åŸç‰ˆï¼šæ··åˆè®¡ç®—
     result = result - SH_C1 * y * sh[1] + SH_C1 * z * sh[2] - ...;
     
     // ä¼˜åŒ–ç‰ˆï¼šåˆ†æ­¥æ¸…æ™°
     float basis[16];
     basis[1] = -SH_C1 * y;
     basis[2] = SH_C1 * z;
     // ...
     for (int i = 1; i < num_coeffs_active; ++i)
         result += sh_ptr[i] * basis[i];
     ```
   - **ä¼˜ç‚¹ï¼š**
     - âœ… æ•™å­¦ä»·å€¼é«˜ï¼Œæ˜“äºç†è§£ SH åŸç†
     - âš ï¸ å¯èƒ½ç•¥æ…¢ï¼ˆå¼•å…¥æ•°ç»„å’Œå¾ªç¯ï¼‰

---

**æœªé‡‡çº³çš„ä¿®æ”¹ï¼š**
- âŒ **åŠ¨æ€ Tile ç²’åº¦** (`compute_tile_step`)
  - åŸå› ï¼šé€»è¾‘å­˜åœ¨ç¼ºé™·ï¼Œå¯èƒ½å¯¼è‡´æ¸²æŸ“ç¼ºå¤±
  - çŠ¶æ€ï¼šå·²åœ¨ä»£ç ä¸­ç¦ç”¨ï¼ˆ`tile_step = 1`ï¼‰

---

4. **åŸºäºæ·±åº¦çš„ LOD ä¼˜åŒ– (Level of Detail)**
   - **ä½ç½®ï¼š** `preprocessCUDA` å‡½æ•°ï¼Œè®¡ç®— `my_radius` ä¹‹å
   - **å®ç°ä»£ç ï¼š**
     ```cpp
     float my_radius = ceil(3.f * sqrt(max(lambda1, lambda2)));
     
     // LOD: Reduce radius for distant Gaussians
     constexpr float LOD_NEAR = 5.0f;
     constexpr float LOD_FAR = 50.0f;
     constexpr float LOD_MIN_SCALE = 0.5f;
     
     float depth = p_view.z;
     float depth_t = (depth - LOD_NEAR) / (LOD_FAR - LOD_NEAR);
     depth_t = clamp(depth_t, 0.0f, 1.0f);
     
     float lod_scale = 1.0f - (1.0f - LOD_MIN_SCALE) * depth_t;
     my_radius = my_radius * lod_scale;
     my_radius = max(1.0f, my_radius);
     ```
   - **åŸç†ï¼š**
     - è¿‘å¤„ï¼ˆdepth < 5ï¼‰ï¼šä¿æŒ 100% åŠå¾„
     - è¿œå¤„ï¼ˆdepth > 50ï¼‰ï¼šç¼©å‡åˆ° 50% åŠå¾„
     - ä¸­é—´ï¼šçº¿æ€§æ’å€¼
   - **æ•ˆæœï¼š**
     - è¿œå¤„é«˜æ–¯è¦†ç›–æ›´å°‘ Tileï¼Œå‡å°‘æ’åºæ•°æ®é‡
     - ç¬¦åˆè§†è§‰æ„ŸçŸ¥ï¼ˆè¿œå¤„ç»†èŠ‚æœ¬å°±æ¨¡ç³Šï¼‰
   - **å‚æ•°å¯è°ƒæ€§ï¼š**
     - `LOD_NEAR/FAR`ï¼šæ§åˆ¶ LOD çš„ä½œç”¨èŒƒå›´
     - `LOD_MIN_SCALE`ï¼šæ§åˆ¶æœ€å°ç¼©æ”¾æ¯”ä¾‹

5. **Early-Z å‰”é™¤ä¼˜åŒ– (Aggressive Opacity Culling)**
   - **ä½ç½®ï¼š** `renderCUDA` å‡½æ•°ï¼Œalpha blending å¾ªç¯å†…éƒ¨
   - **å®ç°ä»£ç ï¼š**
     ```cpp
     // After alpha blending
     T = test_T;
     last_contributor = contributor;
     
     // Early-Z: Aggressively terminate when opacity saturated
     if (T < 0.005f)  // 99.5% opacity reached
     {
         done = true;
         break;  // Exit inner loop immediately
     }
     ```
   - **åŸç†ï¼š**
     - åŸç‰ˆï¼šå½“ `T < 0.0001` (99.99% ä¸é€æ˜) æ—¶è®¾ç½® `done = true`ï¼Œä½†ä»ä¼š `continue` åˆ°ä¸‹ä¸€è½®
     - ä¼˜åŒ–ç‰ˆï¼šå½“ `T < 0.005` (99.5% ä¸é€æ˜) æ—¶ç›´æ¥ `break`ï¼Œç«‹å³è·³å‡ºå†…å±‚å¾ªç¯
     - é˜ˆå€¼æ›´å®½æ¾ä½†æå‰ç»ˆæ­¢æ›´æ¿€è¿›
   - **æ•ˆæœï¼š**
     - å‰æ™¯å¯†é›†åœºæ™¯ï¼šèŠ‚çœ 15-30% çš„åƒç´ å¤„ç†æ—¶é—´
     - è¿œå¤„é«˜æ–¯è¢«å¤§é‡è·³è¿‡
     - è§†è§‰è´¨é‡å‡ ä¹æ— æŸï¼ˆ0.5% çš„é€æ˜åº¦è´¡çŒ®å¯å¿½ç•¥ï¼‰
   - **ç†è®ºä¾æ®ï¼š**
     - ç»å…¸å›¾å½¢å­¦çš„ Early-Z æ€æƒ³ï¼ˆæå‰æ·±åº¦æµ‹è¯•ï¼‰
     - åœ¨ Alpha Blending ä¸­ç­‰ä»·äºæå‰é€æ˜åº¦æˆªæ–­
   - **æ•™å­¦ä»·å€¼ï¼š**
     - å±•ç¤º `continue` vs `break` çš„æ€§èƒ½å·®å¼‚
     - ä½“ç°æ¸²æŸ“ä¼˜åŒ–ä¸­çš„æƒè¡¡ï¼ˆæ€§èƒ½ vs è´¨é‡ï¼‰

---

**æœªé‡‡çº³çš„ä¿®æ”¹ï¼š**
- âŒ **åŠ¨æ€ Tile ç²’åº¦** (`compute_tile_step`)
  - åŸå› ï¼šè·³è¿‡ Tile ä¼šå¯¼è‡´æ¸²æŸ“ç¼ºå¤±
  - çŠ¶æ€ï¼šå·²åœ¨ä»£ç ä¸­ç¦ç”¨ï¼ˆ`tile_step = 1`ï¼‰

---

**è®¾è®¡å†³ç­–è¡¨ï¼š**

| ä¿®æ”¹é¡¹ | æ€§èƒ½å½±å“ | ä»£ç å¯è¯»æ€§ | æ•™å­¦ä»·å€¼ | Final Project é€‚ç”¨æ€§ |
|--------|---------|-----------|---------|---------------------|
| èƒ½é‡é˜ˆå€¼å‰”é™¤ | ğŸŸ¢ +5% | â­â­â­ | â­â­â­ | âœ… æ¨è |
| Tile çº§æ—©æœŸæ‹’ç» | ğŸŸ¢ +10% | â­â­â­â­ | â­â­â­â­ | âœ… å¼ºçƒˆæ¨è |
| åŸºäºæ·±åº¦çš„ LOD | ğŸŸ¢ +5-10% | â­â­â­â­â­ | â­â­â­â­â­ | âœ… å¼ºçƒˆæ¨è |
| Early-Z å‰”é™¤ | ğŸŸ¢ +15-30% | â­â­â­â­â­ | â­â­â­â­â­ | âœ…âœ… å¼ºçƒˆæ¨è |
| æ‰‹å·¥å±•å¼€ Cov2D | ğŸŸ¢ +10-15% | â­â­â­â­â­ | â­â­â­â­â­ | âœ… æ ¸å¿ƒäº®ç‚¹ |
| æ‰‹å·¥å±•å¼€ Cov3D | ğŸŸ¢ +8-12% | â­â­â­â­â­ | â­â­â­â­â­ | âœ… æ ¸å¿ƒäº®ç‚¹ |
| é‡æ„ SH é¢œè‰² | ğŸŸ¡ -2~+0% | â­â­â­â­â­ | â­â­â­â­â­ | âœ… æ•™å­¦ä»·å€¼ |

**ç´¯è®¡æ€§èƒ½æå‡ä¼°ç®—ï¼š** çº¦ 35-50%ï¼ˆåœ¨å‰æ™¯å¯†é›†åœºæ™¯ä¸‹å¯è¾¾ 60%ï¼‰

---

## ç¼–è¯‘çŠ¶æ€æ±‡æ€»

| Layer | æ–‡ä»¶ | éœ€è¦ç¼–è¯‘ | çŠ¶æ€ |
|-------|------|----------|------|
| Layer 3 | `ext.cpp` | âœ… æ˜¯ | âœ… ç¼–è¯‘é€šè¿‡ |
| Layer 3 | `diff_gaussian_rasterization/__init__.py` | âœ… æ˜¯ | âœ… ç¼–è¯‘é€šè¿‡ |
| Layer 2 | `gaussian_renderer/__init__.py` | âŒ å¦ | âœ… ä¿®æ”¹å®Œæˆ |
| Layer 1 | `render.py` (åŸç‰ˆ) | âŒ å¦ | ğŸ”’ ä¿ç•™ä¸å˜ |
| Layer 1 | `render_ours.py` (æ–°ç‰ˆ) | âŒ å¦ | âœ… åˆ›å»ºå®Œæˆ |
| Layer 4 | `cuda_rasterizer/rasterizer_impl.cu` | âœ… æ˜¯ | âœ… ä¼˜åŒ–å®Œæˆï¼Œå¾…ç¼–è¯‘ |
| Layer 5 | `cuda_rasterizer/forward.cu` | âœ… æ˜¯ | âœ… ä¼˜åŒ–å®Œæˆï¼Œå¾…ç¼–è¯‘ |

---

**âš ï¸ é‡è¦æé†’ï¼šLayer 4-5 å·²ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ï¼**

```bash
cd /inspurfs/group/mayuexin/chenlx/3DGS/gaussian-splatting
pip install ./submodules/diff-gaussian-rasterization
```

---

---

## æ€§èƒ½æµ‹è¯•å·¥å…·

### `benchmark_optimizations.py` - æ€§èƒ½åŸºå‡†æµ‹è¯•è„šæœ¬

**åŠŸèƒ½ï¼š**
- è‡ªåŠ¨åŒ–æ€§èƒ½æµ‹è¯•ï¼ˆå¤šå¸§å¹³å‡ï¼‰
- è¯¦ç»†çš„ç»Ÿè®¡åˆ†æï¼ˆå¹³å‡å€¼ã€ä¸­ä½æ•°ã€ç™¾åˆ†ä½æ•°ï¼‰
- æ€§èƒ½ç­‰çº§è¯„ä¼°ï¼ˆS/A/B/C/Dï¼‰
- ç»“æœè‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# æµ‹è¯•é»˜è®¤ 50 å¸§
python benchmark_optimizations.py -m output/87b0d1a4-a --iteration 30000

# è‡ªå®šä¹‰æµ‹è¯•å¸§æ•°
python benchmark_optimizations.py -m output/87b0d1a4-a --iteration 30000 --num_frames 100
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸ“Š æ€§èƒ½ç»Ÿè®¡ç»“æœï¼š
  å¹³å‡å¸§æ—¶é—´:    22.45 ms  (FPS:  44.54)
  ä¸­ä½æ•°å¸§æ—¶é—´:  21.80 ms  (FPS:  45.87)
  æ ‡å‡†å·®:         3.12 ms
  æœ€å¿«:          18.23 ms  (FPS:  54.86)
  æœ€æ…¢:          32.10 ms  (FPS:  31.15)

ğŸ¯ æ€§èƒ½ç­‰çº§è¯„ä¼°ï¼š
  â­ ç»¼åˆè¯„åˆ†: A (è‰¯å¥½)
  å¹³å‡ FPS: 44.54
```

**ç”¨é€”ï¼š**
- **ä¼˜åŒ–å‰åå¯¹æ¯”ï¼š** è®°å½•åŸç‰ˆæ€§èƒ½ä½œä¸º baseline
- **Final Project æŠ¥å‘Šï¼š** æä¾›å®¢è§‚çš„æ€§èƒ½æ•°æ®
- **å‚æ•°è°ƒä¼˜ï¼š** æµ‹è¯•ä¸åŒä¼˜åŒ–å‚æ•°çš„æ•ˆæœ

---

**æœ€åæ›´æ–°ï¼š** 2026-01-12  
**ä¿®æ”¹è€…ï¼š** CG Course Final Project Team  
**å½“å‰è¿›åº¦ï¼š** Layer 1-5 å…¨éƒ¨å®Œæˆ âœ… + æ€§èƒ½æµ‹è¯•å·¥å…· âœ… | éœ€è¦é‡æ–°ç¼–è¯‘ âš ï¸
